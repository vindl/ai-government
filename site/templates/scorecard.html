{% extends "base.html" %}

{% block title %}{{ result.decision.title }} â€” AI Government{% endblock %}

{% block content %}
<article class="scorecard">
  <h1>{{ result.decision.title }}</h1>

  <div class="decision-meta">
    <span class="meta-item"><strong>Date:</strong> {{ result.decision.date }}</span>
    <span class="meta-item"><strong>Category:</strong> {{ result.decision.category }}</span>
    {% if result.decision.source_url %}
    <span class="meta-item"><a href="{{ result.decision.source_url }}">Source</a></span>
    {% endif %}
  </div>

  <blockquote class="decision-summary">{{ result.decision.summary }}</blockquote>

  {% if result.critic_report %}
  <section class="headline-section">
    <h2>{{ result.critic_report.headline }}</h2>
    <div class="scores">
      <div class="score-item">
        <span class="score-label">Decision Score</span>
        <span class="score-value">{{ result.critic_report.decision_score }}/10</span>
        <div class="score-bar"><div class="score-fill" style="width: {{ result.critic_report.decision_score * 10 }}%"></div></div>
      </div>
      <div class="score-item">
        <span class="score-label">Assessment Quality</span>
        <span class="score-value">{{ result.critic_report.assessment_quality_score }}/10</span>
        <div class="score-bar"><div class="score-fill" style="width: {{ result.critic_report.assessment_quality_score * 10 }}%"></div></div>
      </div>
    </div>
  </section>
  {% endif %}

  <section class="ministry-overview">
    <h2>Ministry Verdicts</h2>
    <div class="ministry-cards">
      {% for a in result.assessments %}
      <div class="ministry-card {{ a.verdict.value | verdict_css_class }}">
        <h3>{{ a.ministry }}</h3>
        <span class="verdict">{{ a.verdict.value | verdict_label }}</span>
        <span class="card-score">{{ a.score }}/10</span>
        <p>{{ a.summary }}</p>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="ministry-details">
    <h2>Detailed Analyses</h2>
    {% for a in result.assessments %}
    <div class="ministry-detail">
      <h3>Ministry of {{ a.ministry }}</h3>
      <div class="detail-meta">
        <span class="{{ a.verdict.value | verdict_css_class }}">{{ a.verdict.value | verdict_label }}</span>
        <span>{{ a.score }}/10</span>
      </div>
      {% if a.executive_summary %}
      <div class="executive-summary">
        <strong>Executive Summary:</strong> {{ a.executive_summary }}
      </div>
      {% endif %}
      <details class="full-analysis">
        <summary>Read full analysis</summary>
        <p>{{ a.summary }}</p>
      {% if a.key_concerns %}
      <h4>Key Concerns</h4>
      <ul>
        {% for concern in a.key_concerns %}
        <li>{{ concern }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% if a.recommendations %}
      <h4>Recommendations</h4>
      <ul>
        {% for rec in a.recommendations %}
        <li>{{ rec }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% if a.counter_proposal %}
      <div class="counter-proposal-mini">
        <h4>Counter-proposal: {{ a.counter_proposal.title }}</h4>
        <p>{{ a.counter_proposal.summary }}</p>
        {% if a.counter_proposal.key_changes %}
        <ul>
          {% for change in a.counter_proposal.key_changes %}
          <li>{{ change }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if a.counter_proposal.expected_benefits %}
        <p><strong>Expected benefits:</strong> {{ a.counter_proposal.expected_benefits | join(', ') }}</p>
        {% endif %}
        {% if a.counter_proposal.estimated_feasibility %}
        <p><strong>Feasibility:</strong> {{ a.counter_proposal.estimated_feasibility }}</p>
        {% endif %}
      </div>
      {% endif %}
      </details>
    </div>
    {% endfor %}
  </section>

  {% if result.debate %}
  <section class="debate">
    <h2>Parliamentary Debate</h2>
    <div class="detail-meta">
      <span class="{{ result.debate.overall_verdict.value | verdict_css_class }}">
        {{ result.debate.overall_verdict.value | verdict_label }}
      </span>
    </div>

    <h3>Consensus</h3>
    <p>{{ result.debate.consensus_summary }}</p>

    {% if result.debate.disagreements %}
    <h3>Disagreements</h3>
    <ul>
      {% for d in result.debate.disagreements %}
      <li>{{ d }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <h3>Transcript</h3>
    <div class="transcript">{{ result.debate.debate_transcript }}</div>
  </section>
  {% endif %}

  {% if result.critic_report %}
  <section class="critic">
    <h2>Independent Critical Analysis</h2>
    <p>{{ result.critic_report.overall_analysis }}</p>
    {% if result.critic_report.blind_spots %}
    <h3>Blind Spots</h3>
    <ul>
      {% for bs in result.critic_report.blind_spots %}
      <li>{{ bs }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </section>
  {% endif %}

  {% if result.counter_proposal %}
  <section class="counter-proposal">
    <h2>AI Government Counter-proposal</h2>
    <h3>{{ result.counter_proposal.title }}</h3>
    <p class="executive-summary"><strong>{{ result.counter_proposal.executive_summary }}</strong></p>
    <div class="detailed-proposal">{{ result.counter_proposal.detailed_proposal }}</div>

    {% if result.counter_proposal.key_differences %}
    <h4>Key Differences</h4>
    <ul>
      {% for diff in result.counter_proposal.key_differences %}
      <li>{{ diff }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if result.counter_proposal.implementation_steps %}
    <h4>Implementation Steps</h4>
    <ol>
      {% for step in result.counter_proposal.implementation_steps %}
      <li>{{ step }}</li>
      {% endfor %}
    </ol>
    {% endif %}

    {% if result.counter_proposal.risks_and_tradeoffs %}
    <h4>Risks and Trade-offs</h4>
    <ul>
      {% for risk in result.counter_proposal.risks_and_tradeoffs %}
      <li>{{ risk }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if result.counter_proposal.ministry_contributions %}
    <h4>Ministry Contributions</h4>
    <ul>
      {% for contrib in result.counter_proposal.ministry_contributions %}
      <li>{{ contrib }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </section>
  {% endif %}

  <div class="error-report">
    <p>Found an error in this analysis? <a href="https://github.com/vindl/ai-government/discussions/categories/corrections">Report an error</a></p>
  </div>
</article>
{% endblock %}
