{% extends "base.html" %}

{% block title %}{{ result.decision.title }} â€” AI Government{% endblock %}

{% block content %}
<article class="scorecard bilingual">
  <div class="lang-switcher">
    <button class="lang-btn active" data-lang="mne">Crnogorski</button>
    <button class="lang-btn" data-lang="en">English</button>
  </div>

  <h1>{{ result.decision.title }}</h1>

  <div class="decision-meta">
    <span class="meta-item">
      <strong class="lang-mne">{{ ui.mne.date }}:</strong>
      <strong class="lang-en">{{ ui.en.date }}:</strong>
      {{ result.decision.date }}
    </span>
    <span class="meta-item">
      <strong class="lang-mne">{{ ui.mne.category }}:</strong>
      <strong class="lang-en">{{ ui.en.category }}:</strong>
      {{ result.decision.category }}
    </span>
    {% if result.decision.source_url %}
    <span class="meta-item">
      <a href="{{ result.decision.source_url }}">
        <span class="lang-mne">{{ ui.mne.source }}</span>
        <span class="lang-en">{{ ui.en.source }}</span>
      </a>
    </span>
    {% endif %}
  </div>

  <blockquote class="decision-summary">{{ result.decision.summary }}</blockquote>

  {% if result.critic_report %}
  <section class="headline-section">
    {% if result.critic_report.headline_mne %}
    <h2 class="lang-mne">{{ result.critic_report.headline_mne }}</h2>
    {% endif %}
    <h2 class="lang-en">{{ result.critic_report.headline }}</h2>
    {% if not result.critic_report.headline_mne %}
    <h2 class="lang-mne">{{ result.critic_report.headline }}</h2>
    {% endif %}
    <div class="scores">
      <div class="score-item">
        <span class="score-label">
          <span class="lang-mne">{{ ui.mne.decision_score }}</span>
          <span class="lang-en">{{ ui.en.decision_score }}</span>
        </span>
        <span class="score-value">{{ result.critic_report.decision_score }}/10</span>
        <div class="score-bar"><div class="score-fill" style="width: {{ result.critic_report.decision_score * 10 }}%"></div></div>
      </div>
      <div class="score-item">
        <span class="score-label">
          <span class="lang-mne">{{ ui.mne.assessment_quality }}</span>
          <span class="lang-en">{{ ui.en.assessment_quality }}</span>
        </span>
        <span class="score-value">{{ result.critic_report.assessment_quality_score }}/10</span>
        <div class="score-bar"><div class="score-fill" style="width: {{ result.critic_report.assessment_quality_score * 10 }}%"></div></div>
      </div>
    </div>
  </section>
  {% endif %}

  <section class="ministry-overview">
    <h2>
      <span class="lang-mne">{{ ui.mne.ministry_verdicts }}</span>
      <span class="lang-en">{{ ui.en.ministry_verdicts }}</span>
    </h2>
    <div class="ministry-cards">
      {% for a in result.assessments %}
      <div class="ministry-card {{ a.verdict.value | verdict_css_class }}">
        <h3>{{ a.ministry }}</h3>
        <span class="verdict">
          <span class="lang-mne">{{ a.verdict.value | verdict_label_mne }}</span>
          <span class="lang-en">{{ a.verdict.value | verdict_label }}</span>
        </span>
        <span class="card-score">{{ a.score }}/10</span>
        {% if a.summary_mne %}
        <p class="lang-mne">{{ a.summary_mne }}</p>
        {% endif %}
        <p class="lang-en">{{ a.summary }}</p>
        {% if not a.summary_mne %}
        <p class="lang-mne">{{ a.summary }}</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="ministry-details">
    <h2>
      <span class="lang-mne">{{ ui.mne.detailed_analyses }}</span>
      <span class="lang-en">{{ ui.en.detailed_analyses }}</span>
    </h2>
    {% for a in result.assessments %}
    <div class="ministry-detail">
      <h3>
        <span class="lang-mne">{{ ui.mne.ministry_of }} {{ a.ministry }}</span>
        <span class="lang-en">Ministry of {{ a.ministry }}</span>
      </h3>
      <div class="detail-meta">
        <span class="{{ a.verdict.value | verdict_css_class }}">
          <span class="lang-mne">{{ a.verdict.value | verdict_label_mne }}</span>
          <span class="lang-en">{{ a.verdict.value | verdict_label }}</span>
        </span>
        <span>{{ a.score }}/10</span>
      </div>
      {% if a.executive_summary %}
      <div class="executive-summary">
        <strong>
          <span class="lang-mne">{{ ui.mne.executive_summary }}:</span>
          <span class="lang-en">{{ ui.en.executive_summary }}:</span>
        </strong>
        {% if a.executive_summary_mne %}
        <span class="lang-mne">{{ a.executive_summary_mne }}</span>
        {% endif %}
        <span class="lang-en">{{ a.executive_summary }}</span>
        {% if not a.executive_summary_mne %}
        <span class="lang-mne">{{ a.executive_summary }}</span>
        {% endif %}
      </div>
      {% endif %}
      <details class="full-analysis">
        <summary>
          <span class="lang-mne">{{ ui.mne.read_full_analysis }}</span>
          <span class="lang-en">{{ ui.en.read_full_analysis }}</span>
        </summary>
        {% if a.summary_mne %}
        <p class="lang-mne">{{ a.summary_mne }}</p>
        {% endif %}
        <p class="lang-en">{{ a.summary }}</p>
        {% if not a.summary_mne %}
        <p class="lang-mne">{{ a.summary }}</p>
        {% endif %}
      {% if a.key_concerns %}
      <h4>
        <span class="lang-mne">{{ ui.mne.key_concerns }}</span>
        <span class="lang-en">{{ ui.en.key_concerns }}</span>
      </h4>
      <ul>
        {% for concern in a.key_concerns %}
        <li>{{ concern }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% if a.recommendations %}
      <h4>
        <span class="lang-mne">{{ ui.mne.recommendations }}</span>
        <span class="lang-en">{{ ui.en.recommendations }}</span>
      </h4>
      <ul>
        {% for rec in a.recommendations %}
        <li>{{ rec }}</li>
        {% endfor %}
      </ul>
      {% endif %}
      {% if a.counter_proposal %}
      <div class="counter-proposal-mini">
        <h4>
          <span class="lang-mne">{{ ui.mne.counter_proposal_label }}: {{ a.counter_proposal.title }}</span>
          <span class="lang-en">Counter-proposal: {{ a.counter_proposal.title }}</span>
        </h4>
        {% if a.counter_proposal.summary_mne %}
        <p class="lang-mne">{{ a.counter_proposal.summary_mne }}</p>
        {% endif %}
        <p class="lang-en">{{ a.counter_proposal.summary }}</p>
        {% if not a.counter_proposal.summary_mne %}
        <p class="lang-mne">{{ a.counter_proposal.summary }}</p>
        {% endif %}
        {% if a.counter_proposal.key_changes %}
        <ul>
          {% for change in a.counter_proposal.key_changes %}
          <li>{{ change }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        {% if a.counter_proposal.expected_benefits %}
        <p>
          <strong>
            <span class="lang-mne">{{ ui.mne.expected_benefits }}:</span>
            <span class="lang-en">{{ ui.en.expected_benefits }}:</span>
          </strong>
          {{ a.counter_proposal.expected_benefits | join(', ') }}
        </p>
        {% endif %}
        {% if a.counter_proposal.estimated_feasibility %}
        <p>
          <strong>
            <span class="lang-mne">{{ ui.mne.feasibility }}:</span>
            <span class="lang-en">{{ ui.en.feasibility }}:</span>
          </strong>
          {{ a.counter_proposal.estimated_feasibility }}
        </p>
        {% endif %}
      </div>
      {% endif %}
      </details>
    </div>
    {% endfor %}
  </section>

  {% if result.debate %}
  <section class="debate">
    <h2>
      <span class="lang-mne">{{ ui.mne.parliamentary_debate }}</span>
      <span class="lang-en">{{ ui.en.parliamentary_debate }}</span>
    </h2>
    <div class="detail-meta">
      <span class="{{ result.debate.overall_verdict.value | verdict_css_class }}">
        <span class="lang-mne">{{ result.debate.overall_verdict.value | verdict_label_mne }}</span>
        <span class="lang-en">{{ result.debate.overall_verdict.value | verdict_label }}</span>
      </span>
    </div>

    <h3>
      <span class="lang-mne">{{ ui.mne.consensus }}</span>
      <span class="lang-en">{{ ui.en.consensus }}</span>
    </h3>
    <p>{{ result.debate.consensus_summary }}</p>

    {% if result.debate.disagreements %}
    <h3>
      <span class="lang-mne">{{ ui.mne.disagreements }}</span>
      <span class="lang-en">{{ ui.en.disagreements }}</span>
    </h3>
    <ul>
      {% for d in result.debate.disagreements %}
      <li>{{ d }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    <h3>
      <span class="lang-mne">{{ ui.mne.transcript }}</span>
      <span class="lang-en">{{ ui.en.transcript }}</span>
    </h3>
    <div class="transcript">{{ result.debate.debate_transcript }}</div>
  </section>
  {% endif %}

  {% if result.critic_report %}
  <section class="critic">
    <h2>
      <span class="lang-mne">{{ ui.mne.independent_critical_analysis }}</span>
      <span class="lang-en">{{ ui.en.independent_critical_analysis }}</span>
    </h2>
    {% if result.critic_report.overall_analysis_mne %}
    <p class="lang-mne">{{ result.critic_report.overall_analysis_mne }}</p>
    {% endif %}
    <p class="lang-en">{{ result.critic_report.overall_analysis }}</p>
    {% if not result.critic_report.overall_analysis_mne %}
    <p class="lang-mne">{{ result.critic_report.overall_analysis }}</p>
    {% endif %}
    {% if result.critic_report.blind_spots %}
    <h3>
      <span class="lang-mne">{{ ui.mne.blind_spots }}</span>
      <span class="lang-en">{{ ui.en.blind_spots }}</span>
    </h3>
    <ul>
      {% for bs in result.critic_report.blind_spots %}
      <li>{{ bs }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </section>
  {% endif %}

  {% if result.counter_proposal %}
  <section class="counter-proposal">
    <h2>
      <span class="lang-mne">{{ ui.mne.ai_counter_proposal }}</span>
      <span class="lang-en">{{ ui.en.ai_counter_proposal }}</span>
    </h2>
    <h3>{{ result.counter_proposal.title }}</h3>
    <p class="executive-summary">
      {% if result.counter_proposal.executive_summary_mne %}
      <strong class="lang-mne">{{ result.counter_proposal.executive_summary_mne }}</strong>
      {% endif %}
      <strong class="lang-en">{{ result.counter_proposal.executive_summary }}</strong>
      {% if not result.counter_proposal.executive_summary_mne %}
      <strong class="lang-mne">{{ result.counter_proposal.executive_summary }}</strong>
      {% endif %}
    </p>
    <div class="detailed-proposal">{{ result.counter_proposal.detailed_proposal }}</div>

    {% if result.counter_proposal.key_differences %}
    <h4>
      <span class="lang-mne">{{ ui.mne.key_differences }}</span>
      <span class="lang-en">{{ ui.en.key_differences }}</span>
    </h4>
    <ul>
      {% for diff in result.counter_proposal.key_differences %}
      <li>{{ diff }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if result.counter_proposal.implementation_steps %}
    <h4>
      <span class="lang-mne">{{ ui.mne.implementation_steps }}</span>
      <span class="lang-en">{{ ui.en.implementation_steps }}</span>
    </h4>
    <ol>
      {% for step in result.counter_proposal.implementation_steps %}
      <li>{{ step }}</li>
      {% endfor %}
    </ol>
    {% endif %}

    {% if result.counter_proposal.risks_and_tradeoffs %}
    <h4>
      <span class="lang-mne">{{ ui.mne.risks_and_tradeoffs }}</span>
      <span class="lang-en">{{ ui.en.risks_and_tradeoffs }}</span>
    </h4>
    <ul>
      {% for risk in result.counter_proposal.risks_and_tradeoffs %}
      <li>{{ risk }}</li>
      {% endfor %}
    </ul>
    {% endif %}

    {% if result.counter_proposal.ministry_contributions %}
    <h4>
      <span class="lang-mne">{{ ui.mne.ministry_contributions }}</span>
      <span class="lang-en">{{ ui.en.ministry_contributions }}</span>
    </h4>
    <ul>
      {% for contrib in result.counter_proposal.ministry_contributions %}
      <li>{{ contrib }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </section>
  {% endif %}

  <div class="error-report">
    <p>
      <span class="lang-mne">{{ ui.mne.error_report }}</span>
      <span class="lang-en">{{ ui.en.error_report }}</span>
      <a href="https://github.com/vindl/ai-government/discussions/categories/corrections">
        <span class="lang-mne">{{ ui.mne.report_error }}</span>
        <span class="lang-en">{{ ui.en.report_error }}</span>
      </a>
    </p>
  </div>
</article>
{% endblock %}

{% block scripts %}
<script>
(function() {
  var STORAGE_KEY = 'aigov-lang';
  var defaultLang = 'mne';

  function setLang(lang) {
    document.documentElement.setAttribute('data-lang', lang);
    try { localStorage.setItem(STORAGE_KEY, lang); } catch(e) {}
    var btns = document.querySelectorAll('.lang-btn');
    for (var i = 0; i < btns.length; i++) {
      btns[i].classList.toggle('active', btns[i].getAttribute('data-lang') === lang);
    }
  }

  // Restore saved preference or use default (Montenegrin)
  var saved = null;
  try { saved = localStorage.getItem(STORAGE_KEY); } catch(e) {}
  setLang(saved || defaultLang);

  // Bind toggle buttons
  document.addEventListener('click', function(e) {
    var btn = e.target.closest('.lang-btn');
    if (btn) {
      setLang(btn.getAttribute('data-lang'));
    }
  });
})();
</script>
{% endblock %}
